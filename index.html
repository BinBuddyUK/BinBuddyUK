<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#5D5CDE" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/icon-192.png" type="image/png" />
  <title>BinBuddy UK</title>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log("SW registered:", reg.scope))
          .catch(err => console.log("SW registration failed:", err));
      });
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white font-sans">
  <div class="p-4 text-center">
    <h1 class="text-3xl font-bold text-purple-700">BinBuddy UK</h1>
    <p class="text-sm text-gray-600 dark:text-gray-300">Your Collection Companion</p>
  </div>  <div class="flex justify-around px-2 mb-4">
    <button class="tab-btn px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded" onclick="showTab('schedule')">Schedule</button>
    <button class="tab-btn px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded" onclick="showTab('devices')">Devices</button>
    <button class="tab-btn px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded" onclick="showTab('settings')">Settings</button>
    <button class="tab-btn px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded" onclick="showTab('tips')">Tips</button>
  </div>  <div id="schedule" class="tab p-4">
    <label class="block mb-2 font-semibold">Enter Your Postcode</label>
    <input id="postcode" class="w-full p-2 mb-4 border rounded" placeholder="e.g. M1 1AA" />
    <button onclick="getSchedule()" class="w-full bg-purple-600 text-white py-2 rounded">Get My Collection Schedule</button>
    <div id="schedule-output" class="mt-4"></div>
    <button onclick="exportToCalendar()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded">Export to Calendar (.ics)</button>
  </div>  <div id="devices" class="tab hidden p-4">
    <p class="mb-4">Pair your BinBuddy Light:</p>
    <button class="bg-blue-600 text-white px-4 py-2 rounded">Scan for Devices</button>
    <p class="mt-4">Customize Bin Colors:</p>
    <div class="space-y-2">
      <label>General Waste: <input type="color" /></label><br />
      <label>Recycling: <input type="color" /></label><br />
      <label>Food Waste: <input type="color" /></label>
    </div>
  </div>  <div id="settings" class="tab hidden p-4">
    <h2 class="font-semibold mb-2">Notifications</h2>
    <label><input type="checkbox" /> Push Notifications</label><br />
    <label><input type="checkbox" /> Email Notifications</label><br />
    <label><input type="checkbox" /> SMS Alerts</label>
    <h2 class="font-semibold mt-4 mb-2">Light Behavior</h2>
    <label><input type="range" min="1" max="10" /> Brightness</label><br />
    <label><input type="checkbox" /> Strobe Effect</label>
  </div>  <div id="tips" class="tab hidden p-4">
    <h2 class="font-semibold mb-2">Recycling Tips</h2>
    <ul class="list-disc pl-5">
      <li>Rinse containers before recycling</li>
      <li>Flatten cardboard boxes</li>
      <li>Check council website for rules</li>
    </ul>
    <p class="mt-2 text-sm text-gray-500">More council tips coming soon via RSS.</p>
  </div>  <script>
    function showTab(id) {
      document.querySelectorAll('.tab').forEach(el => el.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    async function getSchedule() {
      const postcode = document.getElementById("postcode").value;
      const output = document.getElementById("schedule-output");
      output.innerHTML = "Loading...";
      try {
        const res = await fetch(`/api/bindata?postcode=${postcode}`);
        const data = await res.json();
        if (!data.success) throw new Error("Failed to fetch");
        output.innerHTML = `
          <p><strong>Council:</strong> ${data.council}</p>
          <ul class="mt-2 list-disc pl-5">
            ${data.bins.map(bin => `<li>${bin.type}: ${new Date(bin.collectionDate).toLocaleDateString()}</li>`).join('')}
          </ul>
        `;
        window.currentSchedule = data.bins;
      } catch (err) {
        output.innerHTML = "Something went wrong. Try again later.";
      }
    }

    function exportToCalendar() {
      if (!window.currentSchedule) return alert("Please load a schedule first.");
      const lines = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//BinBuddyUK//EN"
      ];
      window.currentSchedule.forEach(bin => {
        const date = new Date(bin.collectionDate);
        const dt = date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        lines.push(
          "BEGIN:VEVENT",
          `SUMMARY:${bin.type} Collection`,
          `DTSTART:${dt}`,
          `DTEND:${dt}`,
          `DESCRIPTION:Take out your ${bin.type} bin`,
          "END:VEVENT"
        );
      });
      lines.push("END:VCALENDAR");
      const blob = new Blob([lines.join("\n")], { type: "text/calendar" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "binbuddy-schedule.ics";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script></body>
</html>
