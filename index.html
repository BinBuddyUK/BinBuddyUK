<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BinBuddy UK - Smart Waste Management</title>
  <meta name="description" content="Smart bin collection reminders for UK households"/>
  <meta name="theme-color" content="#5D5CDE"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-title" content="BinBuddy UK"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            'bin-general': '#4B5563',
            'bin-recycling': '#10B981',
            'bin-garden': '#F59E0B',
            'bin-food': '#8B5CF6'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-white dark:bg-gray-900 min-h-screen">
  <script>
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>

  <div class="container mx-auto px-4 py-6 max-w-md">
    <!-- Header -->
    <header class="text-center mb-8">
      <div class="flex items-center justify-center mb-4">
        <div class="w-16 h-16 bg-gradient-to-br from-primary to-purple-600 rounded-2xl flex items-center justify-center mr-4 shadow-lg">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
        <div>
          <h1 class="text-3xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent">
            BinBuddy UK
          </h1>
          <p class="text-gray-600 dark:text-gray-400 font-medium">Your Collection Companion</p>
        </div>
      </div>
    </header>

    <!-- Data Source Indicator -->
    <div id="dataSource" class="hidden mb-4 p-3 rounded-lg text-center">
      <div class="flex items-center justify-center">
        <div id="dataSourceIcon" class="w-3 h-3 rounded-full mr-2"></div>
        <span id="dataSourceText" class="text-sm font-medium"></span>
      </div>
    </div>

    <!-- Location Setup -->
    <div id="locationSetup" class="mb-6">
      <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl p-6 shadow-lg mb-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4 text-center">Find Your Collection Schedule</h2>
        <div class="space-y-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Enter Your Postcode</label>
            <div class="relative">
              <input type="text" id="postcodeInput" placeholder="e.g. M1 1AA, B1 1BB, LS1 1AB..."
                class="w-full px-5 py-4 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary transition-all"/>
            </div>
          </div>
          <button id="findCouncilBtn"
            class="w-full bg-gradient-to-r from-primary to-purple-600 text-white py-4 rounded-xl font-semibold hover:from-purple-600 hover:to-primary transition-all duration-200 shadow-lg transform hover:scale-[1.02]">
            Get My Collection Schedule
          </button>
        </div>
      </div>
    </div>

    <!-- Collection Schedule -->
    <div id="scheduleDisplay" class="hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Collection Schedule</h2>
        <span id="councilName" class="text-sm text-gray-600 dark:text-gray-400 font-medium"></span>
      </div>

      <div class="bg-gradient-to-br from-primary to-purple-600 rounded-2xl p-6 text-white mb-6 shadow-lg">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-bold">Next Collection</h3>
        </div>
        <div id="nextCollection" class="space-y-3 mb-4"></div>
        <div class="flex space-x-3">
          <button id="setReminderBtn" class="flex-1 bg-white/20 hover:bg-white/30 py-3 px-4 rounded-xl text-sm font-semibold transition-all">
            Set Reminder
          </button>
          <button id="markCollectedBtn" class="flex-1 bg-white/20 hover:bg-white/30 py-3 px-4 rounded-xl text-sm font-semibold transition-all">
            Mark Collected
          </button>
        </div>
      </div>

      <!-- Weekly Schedule -->
      <div class="space-y-4">
        <h3 class="text-xl font-bold text-gray-900 dark:text-white">This Week</h3>
        <div id="weeklySchedule" class="space-y-3"></div>
      </div>
    </div>
  </div>

  <!-- SCRIPT SECTION -->
  <script>
    document.getElementById('findCouncilBtn').addEventListener('click', async () => {
      const postcodeInput = document.getElementById('postcodeInput');
      const postcode = postcodeInput.value.trim();

      if (!postcode) {
        alert('Please enter your postcode.');
        return;
      }

      try {
        const response = await fetch(`/api/bindata?postcode=${encodeURIComponent(postcode)}`);
        const data = await response.json();

        if (data.success) {
          document.getElementById('locationSetup').classList.add('hidden');
          document.getElementById('scheduleDisplay').classList.remove('hidden');

          document.getElementById('councilName').textContent = data.council;

          const indicator = document.getElementById('dataSource');
          const icon = document.getElementById('dataSourceIcon');
          const text = document.getElementById('dataSourceText');

          indicator.classList.remove('hidden');
          icon.className = "w-3 h-3 rounded-full mr-2 " + (data.source === 'live' ? 'bg-green-500' : 'bg-yellow-500');
          text.textContent = data.source === 'live' ? 'Live Council Data' : 'Fallback Data';

          const nextCollection = document.getElementById('nextCollection');
          nextCollection.innerHTML = '';

          data.bins.forEach(bin => {
            const div = document.createElement('div');
            div.className = "flex justify-between border-b border-white/30 py-2 text-sm";
            div.innerHTML = `
              <span>${bin.type}</span>
              <span>${new Date(bin.collectionDate).toLocaleDateString('en-UK', {
                weekday: 'short', month: 'short', day: 'numeric'
              })}</span>
            `;
            nextCollection.appendChild(div);
          });

          const weekly = document.getElementById('weeklySchedule');
          if (weekly) {
            weekly.innerHTML = '';
            data.bins.forEach(bin => {
              const div = document.createElement('div');
              div.className = "flex justify-between text-sm text-gray-700 dark:text-gray-300";
              div.innerHTML = `
                <span>${bin.type}</span>
                <span>${bin.nextCollection}</span>
              `;
              weekly.appendChild(div);
            });
          }

        } else {
          alert('Sorry, no bin data found for that postcode.');
        }
      } catch (err) {
        console.error('Error fetching bin data:', err);
        alert('Something went wrong. Please try again later.');
      }
    });
  </script>
</body>
</html>
